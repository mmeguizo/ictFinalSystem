<nz-layout class="app-layout">
  <nz-sider
    class="menu-sidebar"
    nzCollapsible
    nzWidth="256px"
    nzBreakpoint="md"
    [(nzCollapsed)]="isCollapsed"
    [nzTrigger]="null"
  >
    <div class="sidebar-logo">
      <img src="assets/chmsu-logo.png" alt="CHMSU Logo" width="40" height="40" />
      @if (!isCollapsed) {
        <h1>ICT TICKET</h1>
      }
    </div>
    <ul nz-menu nzTheme="dark" nzMode="inline" [nzInlineCollapsed]="isCollapsed">
      <li nz-menu-item nzMatchRouter>
        <a routerLink="/dashboard">
          <i nz-icon nzType="dashboard" nzTheme="outline"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li nz-menu-item nzMatchRouter>
        <a routerLink="/welcome">
          <i nz-icon nzType="home" nzTheme="outline"></i>
          <span>Welcome</span>
        </a>
      </li>
    </ul>
  </nz-sider>
  <nz-layout>
    <nz-header>
      <div class="app-header">
        <i
          class="header-trigger"
          nz-icon
          [nzType]="isCollapsed ? 'menu-unfold' : 'menu-fold'"
          (click)="isCollapsed = !isCollapsed"
        ></i>
        <div class="header-right">
          <div
            nz-dropdown
            [nzDropdownMenu]="userMenu"
            nzTrigger="click"
            nzPlacement="bottomRight"
          >
            <a>
              <img
                [src]="avatarSrc()"
                (error)="handleAvatarError()"
                alt="User avatar"
                class="user-avatar"
                width="32"
                height="32"
              />
            </a>
          </div>

          <nz-dropdown-menu #userMenu="nzDropdownMenu">
            <ul nz-menu>
              <li nz-menu-item (click)="openProfile()">
                <i nz-icon nzType="user" nzTheme="outline"></i>
                <span>Profile</span>
              </li>
              <li nz-menu-divider></li>
              <li nz-menu-item (click)="logout()">
                <i nz-icon nzType="logout" nzTheme="outline"></i>
                <span>Logout</span>
              </li>
            </ul>
          </nz-dropdown-menu>
        </div>
      </div>
    </nz-header>
    <nz-content>
      <div class="inner-content">
        <router-outlet />
      </div>
    </nz-content>
    <nz-footer class="app-footer">
      <div class="footer-content" role="contentinfo" aria-label="Footer">
        Crafted by:
        <a
          href="https://github.com/mmeguizo"
          target="_blank"
          rel="noopener noreferrer"
          class="footer-link"
          aria-label="Visit mmeguizo's GitHub profile"
        >
          meguizo
        </a>
      </div>
    </nz-footer>
  </nz-layout>
</nz-layout>

<!-- Profile modal -->
<nz-modal
  [nzVisible]="isProfileOpen()"
  (nzVisibleChange)="isProfileOpen.set($event)"
  nzTitle="Profile"
  [nzOkDisabled]="!hasProfileChanges()"
  (nzOnCancel)="closeProfile()"
  (nzOnOk)="saveProfile()"
>
  <ng-container *nzModalContent>
    <form [formGroup]="profileForm" nz-form nzLayout="vertical">

       <!-- Email (read-only display) -->
      <nz-form-item>
        <nz-form-label>Email</nz-form-label>
        <nz-form-control>
          <input
            nz-input
            [value]="userEmail() || 'Loading...'"
            readonly
            disabled
            class="email-readonly"
          />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Avatar</nz-form-label>
        <nz-form-control>
          <div class="avatar-row">
            <img
              [src]="avatarSrc()"
              (error)="handleAvatarError()"
              alt="User avatar"
              class="modal-avatar"
              width="80"
              height="80"
            />
            <input
              #fileInput
              type="file"
              accept="image/*"
              style="display: none"
              (change)="onFileSelected($event)"
            />
            <button nz-button nzType="default" type="button" (click)="fileInput.click()">
              <nz-icon nzType="upload" />
              Upload
            </button>
          </div>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Name</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="displayName" placeholder="Your name" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>New password</nz-form-label>
        <nz-form-control>
          <div class="password-field">
            <input
              nz-input
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              placeholder="••••••"
            />
            <button
              nz-button
              nzType="text"
              type="button"
              (click)="showPassword.set(!showPassword())"
            >
              <nz-icon [nzType]="showPassword() ? 'eye-invisible' : 'eye'"></nz-icon>
            </button>
          </div>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Confirm password</nz-form-label>
        <nz-form-control>
          <div class="password-field">
            <input
              nz-input
              [type]="showConfirm() ? 'text' : 'password'"
              formControlName="confirm"
              placeholder="••••••"
            />
            <button nz-button nzType="text" type="button" (click)="showConfirm.set(!showConfirm())">
              <nz-icon [nzType]="showConfirm() ? 'eye-invisible' : 'eye'"></nz-icon>
            </button>
          </div>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>
